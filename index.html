<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Checklist COFCO International</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        body { margin: 0; padding: 0; overflow-x: hidden; }
        .animate-fade-in { animation: fadeIn 0.3s ease-in; }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
    </style>
</head>
<body>
    <div id="root"></div>
    <script type="text/babel">
        const { useState, useRef, useEffect } = React;
        const { ChevronRight, ChevronLeft, Check } = lucide;

        const MobileForm = () => {
          const [currentStep, setCurrentStep] = useState(-1);
          const [showQR, setShowQR] = useState(true);
          const [showWelcome, setShowWelcome] = useState(false);
          const [showPerfilOpcao, setShowPerfilOpcao] = useState(false);
          const [showConclusao, setShowConclusao] = useState(false);
          const [perfilSalvo, setPerfilSalvo] = useState(null);
          const [assinatura, setAssinatura] = useState('');
          const [dataHoraConclusao, setDataHoraConclusao] = useState(null);
          const [assinaturaFormulario, setAssinaturaFormulario] = useState('');
          const canvasRef = useRef(null);
          const canvasFormRef = useRef(null);
          const [isDrawing, setIsDrawing] = useState(false);
          const [isDrawingForm, setIsDrawingForm] = useState(false);
          const [formData, setFormData] = useState({
            tipoServico: '', subTipoServico: '', numeroCNH: '', nomeCompleto: '',
            transportadora: '', tipoVeiculo: '', placaVeiculo: '', episSeguranca: [],
            telefoneWhatsapp: '', regrasAceitas: false, avisosAceitos: false,
            termoAceito: false, email: '', telefone: '', idade: '', interesse: '', mensagem: ''
          });

          const questions = [
            {
              id: 'tipoServico', question: 'Qual o tipo de presta√ß√£o de servi√ßo ser√° realizado?',
              type: 'servico-tipo',
              options: [
                { value: 'Entrega', emoji: 'üì¶' },
                { value: 'Descarga', emoji: 'üöõ' },
                { value: 'Coleta', emoji: 'üìã' }
              ],
              subOptions: {
                'Entrega': [{ value: 'Almoxarifado', emoji: 'üè≠' }, { value: 'Outros', emoji: 'üìù' }],
                'Descarga': [{ value: 'Gesso ou Calc√°rio', emoji: '‚öôÔ∏è' }, { value: 'Outros', emoji: 'üìù' }],
                'Coleta': [{ value: 'Almoxarifado', emoji: 'üè≠' }, { value: 'Outros', emoji: 'üìù' }]
              }
            },
            { id: 'nomeCompleto', question: 'Qual √© o seu nome completo?', type: 'text', placeholder: 'Digite seu nome completo', minWords: 2 },
            { id: 'transportadora', question: 'Qual √© a Transportadora?', type: 'text', placeholder: 'Digite o nome da transportadora', minLength: 3 },
            {
              id: 'tipoVeiculo', question: 'Qual √© o tipo do ve√≠culo?', type: 'veiculo-tipo',
              options: [{ value: 'Ve√≠culo Leve', emoji: 'üöó' }, { value: 'Ve√≠culo de Carga', emoji: 'üöö' }]
            },
            {
              id: 'episSeguranca', question: 'Quais EPIs de seguran√ßa voc√™ est√° usando?', type: 'epis-multiple',
              subtitle: 'Selecione todos que se aplicam',
              options: [
                { value: 'Botas de Seguran√ßa', emoji: 'ü•æ', color: 'from-amber-500 to-orange-600' },
                { value: 'Colete Refletivo', emoji: 'ü¶∫', color: 'from-yellow-400 to-amber-500' },
                { value: '√ìculos de Prote√ß√£o', emoji: 'ü•Ω', color: 'from-blue-400 to-indigo-500' },
                { value: 'Capacete com Jugular', emoji: '‚õëÔ∏è', color: 'from-red-500 to-rose-600' },
                { value: 'Protetor Auricular', emoji: 'üéß', color: 'from-green-500 to-emerald-600' }
              ]
            },
            { id: 'telefoneWhatsapp', question: 'Qual √© o seu n√∫mero para contato e WhatsApp?', type: 'telefone', placeholder: '(00) 00000-0000' },
            {
              id: 'regrasSeguranca', question: 'Regras de Seguran√ßa da Empresa', type: 'regras-aceite',
              subtitle: 'Leia atentamente e confirme que compreendeu',
              regras: [
                { titulo: 'Proibido fumar', descricao: '√â estritamente proibido fumar em qualquer √°rea da empresa', emoji: 'üö≠', tipo: 'proibicao' },
                { titulo: 'Uso de celular', descricao: 'Proibido o uso de celular durante opera√ß√µes e condu√ß√£o de ve√≠culos', emoji: 'üìµ', tipo: 'proibicao' },
                { titulo: 'Proibido consumir alimentos', descricao: '√â proibido consumir qualquer tipo de alimento dentro da empresa', emoji: 'üçî', tipo: 'proibicao' },
                { titulo: 'Velocidade m√°xima', descricao: 'Velocidade m√°xima de 20 km/h dentro das depend√™ncias', emoji: '‚ö†Ô∏è', tipo: 'aviso' },
                { titulo: 'Aten√ß√£o aos pedestres', descricao: 'Mantenha aten√ß√£o redobrada. Pedestres t√™m prioridade', emoji: 'üö∂', tipo: 'advertencia' },
                { titulo: 'Siga a sinaliza√ß√£o', descricao: 'Respeite toda sinaliza√ß√£o horizontal e vertical', emoji: '‚õî', tipo: 'obrigatorio' }
              ]
            },
            {
              id: 'avisosPerigoVeiculos', question: 'Avisos Importantes sobre Ve√≠culos de Carga', type: 'avisos-aceite',
              subtitle: 'Riscos e responsabilidades do condutor',
              avisos: [
                { titulo: 'Pontos cegos', descricao: 'Ve√≠culos de carga possuem pontos cegos amplos. Verifique antes de manobras', emoji: 'üëÅÔ∏è', cor: 'from-red-500 to-rose-600' },
                { titulo: 'Dist√¢ncia de frenagem', descricao: 'Ve√≠culos pesados precisam de maior dist√¢ncia para parar. Mantenha dist√¢ncia segura', emoji: 'üõë', cor: 'from-orange-500 to-red-600' },
                { titulo: 'Cal√ßo nas rodas', descricao: 'OBRIGAT√ìRIO: Utilize cal√ßos de seguran√ßa nas rodas quando o ve√≠culo estiver parado', emoji: 'üî∂', cor: 'from-amber-500 to-orange-600' },
                { titulo: 'Deslonar em locais permitidos', descricao: 'A carga deve ser deslonada APENAS em √°reas autorizadas e sinalizadas', emoji: 'üì¶', cor: 'from-yellow-500 to-amber-600' },
                { titulo: 'Manobras lentas', descricao: 'Realize manobras com calma e aten√ß√£o. Pe√ßa aux√≠lio quando necess√°rio', emoji: 'üîÑ', cor: 'from-blue-500 to-cyan-600' },
                { titulo: 'Pedestres vulner√°veis', descricao: 'Esteja sempre atento. Um acidente pode ser fatal', emoji: '‚ö†Ô∏è', cor: 'from-red-600 to-rose-700' }
              ]
            },
            {
              id: 'termoResponsabilidade', question: 'Termo de Responsabilidade', type: 'termo-aceite',
              subtitle: 'Declara√ß√£o obrigat√≥ria',
              termo: {
                titulo: 'üìã Declaro que:',
                itens: [
                  'Li e compreendi todas as regras de seguran√ßa',
                  'Estou ciente dos riscos envolvidos na opera√ß√£o',
                  'Me comprometo a seguir todas as normas estabelecidas',
                  'Entendo que o n√£o cumprimento pode resultar em expuls√£o',
                  'Assumo total responsabilidade pelas minhas a√ß√µes',
                  'Compreendo a import√¢ncia da seguran√ßa de todos'
                ]
              }
            },
            { id: 'conclusao', question: 'Checklist Conclu√≠do', type: 'conclusao', subtitle: 'Aguarde autoriza√ß√£o para entrada' }
          ];

          const currentQuestion = questions[currentStep];
          
          useEffect(() => {
            const perfilLocal = localStorage.getItem('perfilChecklistCofco');
            if (perfilLocal) {
              try {
                const perfil = JSON.parse(perfilLocal);
                setPerfilSalvo(perfil);
                if (perfil.numeroCNH) {
                  setFormData(prev => ({ ...prev, numeroCNH: perfil.numeroCNH }));
                }
              } catch (e) {
                console.error('Erro ao carregar perfil:', e);
              }
            }
          }, []);
          
          const salvarPerfil = () => {
            const perfil = {
              nomeCompleto: formData.nomeCompleto,
              transportadora: formData.transportadora,
              tipoVeiculo: formData.tipoVeiculo,
              placaVeiculo: formData.placaVeiculo,
              numeroCNH: formData.numeroCNH,
              dataSalvamento: new Date().toISOString()
            };
            localStorage.setItem('perfilChecklistCofco', JSON.stringify(perfil));
            setPerfilSalvo(perfil);
          };
          
          const usarPerfil = () => {
            if (perfilSalvo) {
              setFormData({
                ...formData,
                nomeCompleto: perfilSalvo.nomeCompleto,
                transportadora: perfilSalvo.transportadora,
                tipoVeiculo: perfilSalvo.tipoVeiculo,
                placaVeiculo: perfilSalvo.placaVeiculo,
                numeroCNH: perfilSalvo.numeroCNH || ''
              });
              setShowPerfilOpcao(false);
              setCurrentStep(4);
            }
          };

          const handleInputChange = (value) => {
            setFormData({ ...formData, [currentQuestion.id]: value });
          };

          const isCurrentStepValid = () => {
            if (!currentQuestion || currentQuestion.optional) return true;
            
            if (currentQuestion.type === 'servico-tipo') {
              const tipoServico = formData.tipoServico;
              const subTipo = formData.subTipoServico;
              const cnh = formData.numeroCNH;
              
              if (!tipoServico) return false;
              if (!subTipo) return false;
              
              if (tipoServico === 'Descarga' && subTipo === 'Gesso ou Calc√°rio') {
                return cnh && cnh.length >= 8;
              }
              return true;
            }
            
            if (currentQuestion.id === 'nomeCompleto') {
              const nome = formData.nomeCompleto.trim();
              const palavras = nome.split(/\s+/).filter(p => p.length > 0);
              return palavras.length >= 2;
            }
            
            if (currentQuestion.id === 'transportadora') {
              return formData.transportadora.trim().length >= 3;
            }
            
            if (currentQuestion.type === 'veiculo-tipo') {
              const tipoVeiculo = formData.tipoVeiculo;
              const placa = formData.placaVeiculo;
              if (!tipoVeiculo) return false;
              return placa && placa.length === 7;
            }
            
            if (currentQuestion.type === 'epis-multiple') {
              return formData.episSeguranca.length >= 1;
            }
            
            if (currentQuestion.type === 'telefone') {
              const numeros = formData.telefoneWhatsapp.replace(/\D/g, '');
              return numeros.length === 11;
            }
            
            if (currentQuestion.type === 'regras-aceite') return formData.regrasAceitas === true;
            if (currentQuestion.type === 'avisos-aceite') return formData.avisosAceitos === true;
            if (currentQuestion.type === 'termo-aceite') return formData.termoAceito === true;
            if (currentQuestion.type === 'conclusao') return true;
            
            const value = formData[currentQuestion.id];
            return value && value.trim() !== '';
          };

          const handleNext = () => {
            if (isCurrentStepValid() && currentStep < questions.length - 1) {
              if (currentStep === 3) salvarPerfil();
              setCurrentStep(currentStep + 1);
            }
          };

          const handleBack = () => {
            if (currentStep > 0) setCurrentStep(currentStep - 1);
          };

          const handleSubmit = () => {
            if (isCurrentStepValid()) {
              if (!assinaturaFormulario) {
                alert('‚ö†Ô∏è Por favor, assine antes de enviar o checklist.');
                return;
              }
              setDataHoraConclusao(new Date());
              setShowConclusao(true);
            }
          };

          const startDrawing = (e) => {
            const canvas = canvasRef.current;
            if (!canvas) return;
            const rect = canvas.getBoundingClientRect();
            const x = (e.touches ? e.touches[0].clientX : e.clientX) - rect.left;
            const y = (e.touches ? e.touches[0].clientY : e.clientY) - rect.top;
            const ctx = canvas.getContext('2d');
            ctx.beginPath();
            ctx.moveTo(x, y);
            setIsDrawing(true);
          };

          const draw = (e) => {
            if (!isDrawing) return;
            e.preventDefault();
            const canvas = canvasRef.current;
            if (!canvas) return;
            const rect = canvas.getBoundingClientRect();
            const x = (e.touches ? e.touches[0].clientX : e.clientX) - rect.left;
            const y = (e.touches ? e.touches[0].clientY : e.clientY) - rect.top;
            const ctx = canvas.getContext('2d');
            ctx.lineTo(x, y);
            ctx.strokeStyle = '#000';
            ctx.lineWidth = 2;
            ctx.stroke();
          };

          const stopDrawing = () => {
            setIsDrawing(false);
            const canvas = canvasRef.current;
            if (canvas) setAssinatura(canvas.toDataURL());
          };

          const limparAssinatura = () => {
            const canvas = canvasRef.current;
            if (!canvas) return;
            const ctx = canvas.getContext('2d');
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            setAssinatura('');
          };

          const startDrawingForm = (e) => {
            const canvas = canvasFormRef.current;
            if (!canvas) return;
            const rect = canvas.getBoundingClientRect();
            const x = (e.touches ? e.touches[0].clientX : e.clientX) - rect.left;
            const y = (e.touches ? e.touches[0].clientY : e.clientY) - rect.top;
            const ctx = canvas.getContext('2d');
            ctx.beginPath();
            ctx.moveTo(x, y);
            setIsDrawingForm(true);
          };

          const drawForm = (e) => {
            if (!isDrawingForm) return;
            e.preventDefault();
            const canvas = canvasFormRef.current;
            if (!canvas) return;
            const rect = canvas.getBoundingClientRect();
            const x = (e.touches ? e.touches[0].clientX : e.clientX) - rect.left;
            const y = (e.touches ? e.touches[0].clientY : e.clientY) - rect.top;
            const ctx = canvas.getContext('2d');
            ctx.lineTo(x, y);
            ctx.strokeStyle = '#000';
            ctx.lineWidth = 2;
            ctx.stroke();
          };

          const stopDrawingForm = () => {
            setIsDrawingForm(false);
            const canvas = canvasFormRef.current;
            if (canvas) setAssinaturaFormulario(canvas.toDataURL());
          };

          const limparAssinaturaForm = () => {
            const canvas = canvasFormRef.current;
            if (!canvas) return;
            const ctx = canvas.getContext('2d');
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            setAssinaturaFormulario('');
          };

          const enviarWhatsApp = async () => {
            const dadosParaEnviar = {
              nomeCompleto: formData.nomeCompleto.toUpperCase(),
              transportadora: formData.transportadora.toUpperCase(),
              telefoneWhatsapp: formData.telefoneWhatsapp,
              tipoServico: formData.tipoServico.toUpperCase(),
              subTipoServico: formData.subTipoServico.toUpperCase(),
              tipoVeiculo: formData.tipoVeiculo.toUpperCase(),
              placaVeiculo: formData.placaVeiculo.toUpperCase(),
              numeroCNH: formData.numeroCNH || '',
              episSeguranca: formData.episSeguranca,
              assinatura: assinatura,
              assinaturaFormulario: assinaturaFormulario
            };
            
            try {
              const url = 'https://script.google.com/macros/s/AKfycbw9PmuTPwSp8hfVCpXSnQd3eEPUeCfX_z2yGG7eVIxq96TcbdpzokgoIzB_ps78C93Blg/exec';
              
              await fetch(url, {
                method: 'POST',
                mode: 'no-cors',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(dadosParaEnviar)
              });
              
              alert('‚úÖ Checklist enviado com sucesso!\\n\\nVoc√™ receber√° uma mensagem no WhatsApp com sua senha quando estiver liberado para entrar.\\n\\n‚è≥ Aguarde no ve√≠culo ou em √°rea segura.');
              
              setTimeout(() => {
                window.location.reload();
              }, 2000);
              
            } catch (error) {
              alert('‚ùå Erro ao enviar. Verifique sua conex√£o e tente novamente.');
              console.error(error);
            }
          };

          const getTipText = () => {
            if (currentStep < 0 || currentStep >= questions.length) return '';
            const tips = {
              'tipoServico': 'üí° Selecione o tipo de servi√ßo e depois escolha a categoria espec√≠fica',
              'nomeCompleto': 'üë§ Digite seu nome completo (nome e sobrenome)',
              'transportadora': 'üöõ Informe o nome da empresa transportadora',
              'tipoVeiculo': 'üöó Escolha o tipo de ve√≠culo e informe a placa',
              'episSeguranca': 'üõ°Ô∏è Sua seguran√ßa √© prioridade! Selecione os EPIs que voc√™ est√° usando',
              'telefoneWhatsapp': 'üì± Digite seu n√∫mero de celular com DDD para contato via WhatsApp',
              'regrasSeguranca': '‚ö†Ô∏è Estas regras s√£o obrigat√≥rias para sua seguran√ßa e de todos',
              'avisosPerigoVeiculos': 'üö® Informa√ß√µes cr√≠ticas sobre opera√ß√£o segura de ve√≠culos',
              'termoResponsabilidade': 'üìù Sua confirma√ß√£o √© necess√°ria para prosseguir',
              'conclusao': '‚úÖ Parab√©ns! Voc√™ completou todas as etapas'
            };
            return tips[currentQuestion.id] || '';
          };

          // TELA QR CODE
          if (showQR) {
            return (
              <div className="min-h-screen bg-gradient-to-br from-blue-600 via-blue-400 to-cyan-300 flex items-center justify-center p-4">
                <div className="bg-white rounded-3xl shadow-2xl p-6 max-w-md w-full text-center">
                  <h1 className="text-4xl font-bold text-gray-800 mb-1">COFCO</h1>
                  <h2 className="text-3xl font-bold text-blue-600 mb-3">International</h2>
                  <p className="text-gray-600 text-sm mb-6">Formul√°rio de Acesso</p>
                  
                  <button
                    onClick={() => {
                      setShowQR(false);
                      setShowWelcome(true);
                    }}
                    className="w-full bg-gradient-to-r from-blue-600 to-cyan-600 text-white font-semibold py-3 px-6 rounded-xl hover:shadow-lg transform hover:scale-105 transition-all duration-200"
                  >
                    Abrir Formul√°rio
                  </button>
                </div>
              </div>
            );
          }

          // TELA BEM-VINDO
          if (showWelcome) {
            return (
              <div className="min-h-screen bg-gradient-to-br from-blue-600 via-blue-400 to-cyan-300 flex items-center justify-center p-4">
                <div className="bg-white rounded-3xl shadow-2xl overflow-hidden max-w-md w-full">
                  <div className="bg-gradient-to-r from-blue-600 to-cyan-500 p-8 text-center">
                    <h1 className="text-3xl font-bold text-white mb-2">Bem-vindo √†</h1>
                    <h2 className="text-2xl font-bold text-white">COFCO International</h2>
                  </div>
                  <div className="p-8">
                    <h3 className="text-2xl font-bold text-gray-800 mb-4 text-center">Checklist de Seguran√ßa</h3>
                    <button
                      onClick={() => {
                        setShowWelcome(false);
                        if (perfilSalvo) {
                          setShowPerfilOpcao(true);
                        } else {
                          setCurrentStep(0);
                        }
                      }}
                      className="w-full bg-gradient-to-r from-blue-600 to-cyan-600 text-white font-bold py-4 px-6 rounded-xl hover:shadow-lg transform hover:scale-105 transition-all duration-200 flex items-center justify-center gap-2"
                    >
                      Iniciar Checklist
                      <ChevronRight size={20} />
                    </button>
                  </div>
                </div>
              </div>
            );
          }

          // TELA EM DESENVOLVIMENTO (tempor√°ria)
          return (
            <div className="min-h-screen bg-gradient-to-br from-blue-600 via-blue-400 to-cyan-300 flex items-center justify-center p-4">
              <div className="bg-white rounded-3xl shadow-2xl p-8 max-w-md w-full text-center">
                <h1 className="text-2xl font-bold text-gray-800 mb-4">‚úÖ Funcionou!</h1>
                <p className="text-gray-600 mb-4">O formul√°rio est√° carregando corretamente.</p>
                <p className="text-sm text-blue-600">Etapa atual: {currentStep}</p>
              </div>
            </div>
          );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<MobileForm />);
        lucide.createIcons();
    </script>
</body>
</html>
